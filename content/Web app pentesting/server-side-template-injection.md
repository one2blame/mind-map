---
title: Server side template injection (SSTI)
tags:
  - web-app
  - pentesting
  - server
  - side
  - template
  - injection
---

**SSTI** is a vulnerability where a server uses an attacker's input to render a template but fails
to sanitize the content provided, enabling the attacker to inject scripts or other malicious
artifacts, enabling [[cross-site-scripting|XSS]] attacks or remote code execution (RCE) once the
template is rendered. Below is a good introduction to SSTI from OWASP:

- [Testing for Server Side Template Injection](https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/07-Input_Validation_Testing/18-Testing_for_Server_Side_Template_Injection)

## Templating engine discovery

There are various templating engines for web technologies, some examples are:

| Templating engine | Language   | Server / client side |
| ----------------- | ---------- | -------------------- |
| Twig              | PHP        | Server side          |
| Freemarker        | Java       | Server side          |
| Pug / Jade        | JavaScript | Server side          |
| Jinja             | Python     | Server side          |
| Handlebars        | JavaScript | Both                 |
| Mustache          | Multiple   | Varies               |

Knowing what template engine we're targeting is pivotal to successful exploitation. To discover the
templating engine for a target we suspect is vulnerable to SSTI, follow their documentation and
attempt to use engine-specific syntax to discover the target's templating engine.

## Code execution with Twig

Some features of Twig enable attackers to gain RCE on PHP servers using SSTI. Using **filters** that
take functions as arguments, we can provide `system` as a function, and then our argument can be
some `bash` command that will be executed on the host via PHP. For example, we use the
[`reduce`](https://twig.symfony.com/doc/3.x/filters/reduce.html) filter to read files on the host:

```twig
{{ [0]|reduce('system', 'cat /etc/passwd') }}
```

- [Twig - Filters](https://twig.symfony.com/doc/2.x/filters/index.html)
